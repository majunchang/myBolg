---
title: reactå…¨å®¶æ¡¶ NodeJS MongoDBæ­å»ºå®æ—¶èŠå¤©çš„app
date: 2018-07-09 22:23:40
tags: React
categories: React
---
ğŸ‘‰ GitHub: https://github.com/majunchang/reachChatApp


#####  åŸºäº==React(16.x)== å…¨å®¶æ¡¶åˆ¶ä½œçš„ä¸€æ¬¾å®æ—¶èŠå¤©appï¼Œé‡‡ç”¨ç»„ä»¶åŒ–ï¼Œæ¨¡å—åŒ–çš„å¼€å‘æ–¹å¼ï¼Œç”¨åˆ°äº†==react-redux==ç­‰æ’ä»¶ï¼Œä½¿ç”¨==antd-mobile==çš„uiæ¡†æ¶ã€‚

#### æŠ€æœ¯æ ˆ

##### ã€å‰ç«¯ã€‘
- React: ç”¨äºæ­å»ºç”¨æˆ·ç•Œé¢çš„javascriptåº“ï¼Œç‰¹ç‚¹æ˜¯å£°æ˜å¼æ¸²æŸ“å’Œç»„ä»¶åŒ–å¼€å‘
- Redux: Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚è®©ä½ æ„å»ºä¸€è‡´åŒ–çš„åº”ç”¨ï¼Œè¿è¡Œä¸ä¸åŒçš„ç¯å¢ƒï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯•ã€‚
- React-redux: æ ¸å¿ƒåœ¨äºproviederï¼Œconnectå’Œä¸­é—´ä»¶æœºåˆ¶ã€‚
- React-router:æ˜¯ä¸€ä¸ªåŸºäº React ä¹‹ä¸Šçš„å¼ºå¤§è·¯ç”±åº“ï¼Œå®ƒå¯ä»¥è®©ä½ å‘åº”ç”¨ä¸­å¿«é€Ÿåœ°æ·»åŠ è§†å›¾å’Œæ•°æ®æµï¼ŒåŒæ—¶ä¿æŒé¡µé¢ä¸ URL é—´çš„åŒæ­¥ã€‚
##### ã€åç«¯ã€‘
- NodeJs:ä½¿ç”¨ express æ„å»ºä¸€ä¸ªæœ¬åœ° HTTP server æ¥è°ƒè¯• React é¡¹ç›®
- MongoDB: å­˜å‚¨ç”¨æˆ·æ•°æ®å’ŒèŠå¤©æ•°æ®çš„éå…³ç³»å‹æ•°æ®åº“
- Express: Nodeçš„åŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ web å¼€å‘æ¡†æ¶ã€‚

##### ã€è‡ªåŠ¨åŒ–æ„å»ºã€‘
- create-react-app: å®˜ç½‘æä¾›çš„reactè„šæ‰‹æ¶å·¥å…·ï¼Œå¿«é€Ÿåˆå§‹åŒ–é¡¹ç›®ä»£ç 
- eslintï¼š ä»£ç é£æ ¼æ£€æŸ¥å·¥å…·ï¼Œè§„èŒƒä»£ç ä¹¦å†™


##  æŠ€æœ¯è¯¦è§£
> reactä¸­æ³¨æ„çš„åœ°ç‚¹
> ##### ç»‘å®šäº‹ä»¶ï¼Œstateå’Œactionsçš„æ˜ å°„ï¼Œè·¯ç”±åŒ…å«çš„switchç­‰
#### ç™»å½•å’Œæ³¨å†Œéƒ¨åˆ†ï¼ˆä»¥ç™»å½•ä¸¾ä¾‹ï¼‰
1. é¦–å…ˆå‘é€ä¸€ä¸ªæ¥å£è¯·æ±‚åç«¯ï¼Œæ£€æµ‹æ˜¯å¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚æ²¡æœ‰çš„è¯ ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µ
2. ç™»å½•è¿™é‡Œ å¯¹è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç åšä¸€ä¸‹æ ¡éªŒ ç„¶åå­˜å‚¨åˆ°æœ¬åœ°ä¸€ä¸ªç”¨æˆ·id
3. ç™»å½•è¿”å›æˆåŠŸä¹‹ådispatchè¿”å›æ•°æ® è§¦å‘reducer  å°†æ•°æ®å­˜å‚¨åˆ°stateä¸­
#### ä¸»é¡µä»¥åŠåˆ‡æ¢éƒ¨åˆ†
1. å¤´éƒ¨å’Œåº•éƒ¨ä½¿ç”¨å…±æœ‰éƒ¨åˆ†ï¼Œä¸­é—´çš„å†…å®¹ä½¿ç”¨æ•°ç»„ä¸­å¾ªç¯æ¸²æŸ“ä¸åŒçš„Route
2. ç™»å½•æˆåŠŸä¹‹åï¼Œæœ‰äº†redirecté€‰é¡¹ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨Loginä¸­ï¼Œè®¾ç½®äº†è·¯ç”±çš„è·³è½¬

```js
{this.props.redirectTo && this.props.redirectTo !== '/login' ?
                    <Redirect to={this.props.redirectTo}></Redirect> : null}
```
3. æˆ‘ä»¬åœ¨è¿™äº›å­ç»„ä»¶ä¸­ ä½¿ç”¨@connectæ–¹æ³•, å°†reduxä¸­çš„stateå’Œactionä¼ é€’è¿›æ¥
#### èŠå¤©æ•°æ®çš„å±•ç¤º
1. ä¸»è¦æ˜¯ä½¿ç”¨socket.io å®ç°æ•°æ®é€šä¿¡åŸç†
2. åç«¯ä½¿ç”¨express+socketioçš„ç»“åˆï¼Œå‰ç«¯ç›‘å¬ç«¯å£å·9000ä»¥åï¼Œè¿›è¡Œäº†æ•°æ®çš„äº¤äº’å’Œæ¥æ”¶
3.  æˆ‘ä»¬åœ¨æ¯æ¡æ•°æ®ä¸Š åŠ ä¸Šäº†å…¶ä»–çš„ä¸€äº›å€¼ å½¢æˆä¸€ä¸ªå¯¹è±¡ã€‚æ ¹æ®å‘æ”¶æ–¹çš„ç”¨æˆ·id è¿›è¡Œè¾¨åˆ«å’Œæ•°ç»„çš„å¾ªç¯æ¸²æŸ“
#### æœªè¯»æ¶ˆæ¯çš„æ›´æ–°
1. é»˜è®¤æ¯æ¡æ•°æ®çš„readå­—æ®µ éƒ½æ˜¯falseï¼Œç­›é€‰èŠå¤©æ•°æ®çš„å‘é€å¯¹è±¡æ˜¯æ­£åœ¨ä½¿ç”¨è¿™ä¸ªè½¯ä»¶çš„ç”¨çš„æ—¶å€™ï¼Œç­›é€‰å‡ºæ¥çš„ç»“æœå°±æ˜¯æœªè¯»æ¶ˆæ¯çš„æ•°é‡
2. socket ä½¿ç”¨emitè§¦å‘ onæ¥æ¥å—  å½“æ¥å—åˆ°ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™  æœªè¯»æ¶ˆæ¯åŠ 1
3. å½“æˆ‘ä»¬ä»èŠå¤©é¡µé¢é€€å‡ºçš„æ—¶å€™ æŠŠè¿™ä¸ªèŠå¤©ç•Œé¢çš„å¯¹æ–¹çš„idå‘é€ç»™åç«¯è¿›è¡Œå¤„ç† å°†æ€»ä½“æœªè¯»æ¶ˆæ¯æ•°é‡ å‡å»è¿™ä¸ªidçš„ç»´åº¦æ¶ˆæ¯æ•°é‡

####  é¢„è§ˆæ•ˆæœ
![mark](http://upload-images.jianshu.io/upload_images/5703029-3cedeb9c04dc141d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![mark](http://upload-images.jianshu.io/upload_images/5703029-f560598c5e9a441d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![mark](http://upload-images.jianshu.io/upload_images/5703029-41ac2d31b767d086.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![mark](http://upload-images.jianshu.io/upload_images/5703029-09e152869d73b18d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![mark](http://upload-images.jianshu.io/upload_images/5703029-cf00a857ab4ff7b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
##  å¿«é€Ÿå¼€å§‹
##### å¼€å‘ç‰ˆ

```

//  å¼€å¯mongodbæ•°æ®åº“æœåŠ¡
//  å°†é¡¹ç›®åœ°å€å®Œæ•´çš„cloneä¸‹æ¥ 
    git clone https://github.com/majunchang/reachChatApp
//  è¿›å…¥åˆ°é¡¹ç›®æ–‡ä»¶å¤¹  å®‰è£…ç›¸å…³ä¾èµ–
    cd reatChatApp 
    npm install
//  è¿›è¡Œæœ¬åœ°ç¼–è¯‘
    npm start
//  è¿›å…¥åˆ°serveræ–‡ä»¶å¤¹é‡Œé¢ å¯åŠ¨nodejsæœåŠ¡  å»ºè®®ä½¿ç”¨nodemonå¯åŠ¨
    nodeï¼ˆndoemonï¼‰ server
   
```
##### ç”Ÿäº§ç‰ˆ


```
//  å¼€å¯mongodbæ•°æ®åº“æœåŠ¡
//  å°†é¡¹ç›®åœ°å€å®Œæ•´çš„cloneä¸‹æ¥ 
    git clone https://github.com/majunchang/reachChatApp
//  è¿›å…¥åˆ°é¡¹ç›®æ–‡ä»¶å¤¹  å®‰è£…ç›¸å…³ä¾èµ–
    cd reatChatApp 
    npm install
//  é¦–å…ˆå°†é¡¹ç›®è¿›è¡Œæ‰“åŒ… ç„¶åå¯åŠ¨æ‰“åŒ…çš„ç«¯å£ï¼ˆserver.js)ä¸­å·²ç»é…ç½®
    npm run build
//  å®Œæˆä¹‹å
    npm run server 

```





<div align=center>
<img width="300" height="300" src="http://oneg19f80.bkt.clouddn.com/18-3-16/36877665.jpg">
</div>
